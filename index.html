<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
			rel="stylesheet"
			integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
			crossorigin="anonymous"
		/>
		<title>Test chat</title>
	</head>
	<body>
		<!-- Создание меню на сайте (без функций) -->
		<nav class="navbar bg-light">
			<div class="container-fluid">
				<a class="navbar-brand">Navbar</a>
				<form class="d-flex" role="search">
					<input
						class="form-control me-2"
						type="search"
						placeholder="Search"
						aria-label="Search"
					/>
					<button class="btn btn-outline-success" type="submit">Search</button>
				</form>
			</div>
		</nav>
		<!-- Основная часть страницы -->
		<div class="container">
			<div class="py-5 text-center">
				<h2>Чат программа</h2>
				<p class="lead">Укажите ваше имя и начинайте переписку</p>
			</div>
			<div class="row">
				<div class="col-6">
					<!-- Форма для получения сообщений и имени -->
					<h3>Форма сообщений</h3>
					<form id="messForm">
						<label for="name">Имя</label>
						<input
							type="text"
							name="name"
							id="name"
							placeholder="Введите имя"
							class="form-control"
						/>
						<br />
						<label for="message">Сообщение</label>
						<textarea
							name="message"
							id="message"
							class="form-control"
							placeholder="Введите сообщение"
						></textarea>
						<br />
						<input type="submit" value="Отправить" class="btn btn-danger" />
					</form>
				</div>
				<div class="col-6">
					<h3>Сообщения</h3>
					<!-- Вывод всех сообщений будет здесь -->
					<div id="all_mess"></div>
					<div id="feedback"></div>
				</div>
			</div>
		</div>

		<script
			src="https://cdn.socket.io/4.5.4/socket.io.min.js"
			integrity="sha384-/KNQL8Nu5gCHLqwqfQjA689Hhoqgi2S84SNUxC3roTe4EhJ9AfLkp8QiQcU8AMzI"
			crossorigin="anonymous"
		></script>
		<script>
			const socket = io()

			let form = document.getElementById('messForm')
			let name = document.getElementById('name')
			let mess = document.getElementById('message')
			let allMess = document.getElementById('all_mess')
			let feedback = document.getElementById('feedback')

			form.addEventListener('submit', handleSubmit)

			function handleSubmit(e) {
				e.preventDefault()

				socket.emit('send mess', { name: name.value, mess: mess.value })

				mess.value = ''
			}

			mess.addEventListener('keydown', data => {
				socket.emit('typing', name.value)
			})

			socket.on('add mess', data => {
				feedback.innerHTML = ''
				const markup = `<div class='alert'><b>
						${data.name}
						</b>:  
						${data.mess}
						</div>`

				allMess.insertAdjacentHTML('beforeend', markup)
			})

			socket.on('typing', name => {
				feedback.innerHTML = `<p><b>${name}</b> is typing...</p>`
			})
		</script>
	</body>
</html>
